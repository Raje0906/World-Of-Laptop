Updated code with latest changes
